!function(e){"use strict";e.browser||(e.browser={},e.browser.mozilla=/mozilla/.test(navigator.userAgent.toLowerCase())&&!/webkit/.test(navigator.userAgent.toLowerCase()),e.browser.webkit=/webkit/.test(navigator.userAgent.toLowerCase()),e.browser.opera=/opera/.test(navigator.userAgent.toLowerCase()),e.browser.msie=/msie/.test(navigator.userAgent.toLowerCase()));var t={destroy:function(){return e(this).unbind(".maskMoney"),e.browser.msie&&(this.onpaste=null),this},mask:function(t){return this.each(function(){var n,a=e(this);return"number"==typeof t&&(a.trigger("mask"),n=e(a.val().split(/\D/)).last()[0].length,t=t.toFixed(n),a.val(t)),a.trigger("mask")})},unmasked:function(){return this.map(function(){var t,n=e(this).val()||"0",a=-1!==n.indexOf("-");return e(n.split(/\D/).reverse()).each(function(e,n){if(n)return t=n,!1}),n=(n=n.replace(/\D/g,"")).replace(new RegExp(t+"$"),"."+t),a&&(n="-"+n),parseFloat(n)})},init:function(t){return t=e.extend({prefix:"",suffix:"",affixesStay:!0,thousands:",",decimal:".",precision:2,allowZero:!1,allowNegative:!1},t),this.each(function(){function n(){var e,t,n,a,r,i=b.get(0),o=0,s=0;return"number"==typeof i.selectionStart&&"number"==typeof i.selectionEnd?(o=i.selectionStart,s=i.selectionEnd):(t=document.selection.createRange())&&t.parentElement()===i&&(a=i.value.length,e=i.value.replace(/\r\n/g,"\n"),(n=i.createTextRange()).moveToBookmark(t.getBookmark()),(r=i.createTextRange()).collapse(!1),n.compareEndPoints("StartToEnd",r)>-1?o=s=a:(o=-n.moveStart("character",-a),o+=e.slice(0,o).split("\n").length-1,n.compareEndPoints("EndToEnd",r)>-1?s=a:(s=-n.moveEnd("character",-a),s+=e.slice(0,s).split("\n").length-1))),{start:o,end:s}}function a(){var e=!(b.val().length>=b.attr("maxlength")&&b.attr("maxlength")>=0),t=n(),a=t.start,r=t.end,i=!(t.start===t.end||!b.val().substring(a,r).match(/\d/)),o="0"===b.val().substring(0,1);return e||i||o}function r(e){b.each(function(t,n){if(n.setSelectionRange)n.focus(),n.setSelectionRange(e,e);else if(n.createTextRange){var a=n.createTextRange();a.collapse(!0),a.moveEnd("character",e),a.moveStart("character",e),a.select()}})}function i(e){var n="";return e.indexOf("-")>-1&&(e=e.replace("-",""),n="-"),n+t.prefix+e+t.suffix}function o(e){var n,a,r,o=e.indexOf("-")>-1&&t.allowNegative?"-":"",s=e.replace(/[^0-9]/g,""),l=s.slice(0,s.length-t.precision);return""===(l=(l=l.replace(/^0*/g,"")).replace(/\B(?=(\d{3})+(?!\d))/g,t.thousands))&&(l="0"),n=o+l,t.precision>0&&(a=s.slice(s.length-t.precision),r=new Array(t.precision+1-a.length).join(0),n+=t.decimal+r+a),i(n)}function s(e){var t=b.val().length;b.val(o(b.val())),r(e-=t-b.val().length)}function l(){var e=b.val();b.val(o(e))}function c(){var e=b.val();return t.allowNegative?""!==e&&"-"===e.charAt(0)?e.replace("-",""):"-"+e:e}function u(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function v(t){var r,i,o,l,v,f=(t=t||window.event).which||t.charCode||t.keyCode;return f!==undefined&&(f<48||f>57?45===f?(b.val(c()),!1):43===f?(b.val(b.val().replace("-","")),!1):13===f||9===f||(!(!e.browser.mozilla||37!==f&&39!==f||0!==t.charCode)||(u(t),!0)):!!a()&&(u(t),r=String.fromCharCode(f),o=(i=n()).start,l=i.end,v=b.val(),b.val(v.substring(0,o)+r+v.substring(l,v.length)),s(o+1),!1))}function f(e){var a,r,i,o,l,c=(e=e||window.event).which||e.charCode||e.keyCode;return c!==undefined&&(r=(a=n()).start,i=a.end,8!==c&&46!==c&&63272!==c||(u(e),o=b.val(),r===i&&(8===c?""===t.suffix?r-=1:(l=o.split("").reverse().join("").search(/\d/),i=(r=o.length-l-1)+1):i+=1),b.val(o.substring(0,r)+o.substring(i,o.length)),s(r),!1))}function g(){w=b.val(),l();var e,t=b.get(0);t.createTextRange&&((e=t.createTextRange()).collapse(!1),e.select())}function d(){setTimeout(function(){l()},0)}function p(){return(parseFloat("0")/Math.pow(10,t.precision)).toFixed(t.precision).replace(new RegExp("\\.","g"),t.decimal)}function h(n){if(e.browser.msie&&v(n),""===b.val()||b.val()===i(p()))t.allowZero?t.affixesStay?b.val(i(p())):b.val(p()):b.val("");else if(!t.affixesStay){var a=b.val().replace(t.prefix,"").replace(t.suffix,"");b.val(a)}b.val()!==w&&b.change()}function m(){var e,t=b.get(0);t.setSelectionRange?(e=b.val().length,t.setSelectionRange(e,e)):b.val(b.val())}var w,b=e(this);t=e.extend(t,b.data()),b.unbind(".maskMoney"),b.bind("keypress.maskMoney",v),b.bind("keydown.maskMoney",f),b.bind("blur.maskMoney",h),b.bind("focus.maskMoney",g),b.bind("click.maskMoney",m),b.bind("cut.maskMoney",d),b.bind("paste.maskMoney",d),b.bind("mask.maskMoney",l)})}};e.fn.maskMoney=function(n){return t[n]?t[n].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof n&&n?void e.error("Method "+n+" does not exist on jQuery.maskMoney"):t.init.apply(this,arguments)}}(window.jQuery||window.Zepto);
